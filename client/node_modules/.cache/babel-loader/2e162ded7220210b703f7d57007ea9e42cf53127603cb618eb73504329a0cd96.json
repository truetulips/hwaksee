{"ast":null,"code":"import{useState,useEffect,useCallback}from'react';import{useNavigate}from'react-router-dom';import PostRegister from'../components/PostRegister';import PostList from'../components/PostList';import axios from'../api/axios';import styles from'../css/Posts.module.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function MyPosts(_ref){let{user}=_ref;const[posts,setPosts]=useState([]);const[showForm,setShowForm]=useState(false);const[matchCodeInput,setMatchCodeInput]=useState('');const[availablePosts,setAvailablePosts]=useState([]);const token=localStorage.getItem('token');const navigate=useNavigate();// ✅ 글 조회\nconst fetchPosts=useCallback(async()=>{try{var _res$data$posts;const res=await axios.get('/posts',{headers:{Authorization:\"Bearer \".concat(token)}});const allPosts=Array.isArray(res.data)?res.data:(_res$data$posts=res.data.posts)!==null&&_res$data$posts!==void 0?_res$data$posts:[];const myPosts=allPosts.filter(post=>post.author===user._id||post.matcher===user._id||user.role==='admin');const matchablePosts=allPosts.filter(post=>post.author!==user._id&&!post.matcher);setPosts(myPosts);setAvailablePosts(matchablePosts);}catch(err){console.error('글 불러오기 실패:',err.message);}},[user._id,user.role,token]);useEffect(()=>{fetchPosts();},[fetchPosts]);// ✅ 글 등록\nconst handlePostCreated=newPost=>{setPosts(prev=>[newPost,...prev]);setShowForm(false);};// ✅ 글 수정\nconst handleUpdate=updatedPost=>{setPosts(prev=>prev.map(post=>post._id===updatedPost._id?updatedPost:post));};const handleRefresh=()=>{fetchPosts();};// ✅ 매칭코드 입력\nconst handleMatchCode=async code=>{if(!code||code.length<4){alert('매칭코드를 정확히 입력해주세요.');return;}try{const res=await axios.post('/posts/match',{matchCode:code},{headers:{Authorization:\"Bearer \".concat(token)}});alert('매칭 성공!');navigate(\"/posts/\".concat(res.data.post._id));}catch(err){var _err$response,_err$response$data;const msg=((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'서버 오류';alert(\"\\uB9E4\\uCE6D \\uC2E4\\uD328: \".concat(msg));}};return/*#__PURE__*/_jsx(\"section\",{children:/*#__PURE__*/_jsxs(\"div\",{className:styles.container,children:[/*#__PURE__*/_jsx(\"h2\",{className:styles.tit,children:\"My Posts\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowForm(prev=>!prev),className:styles.registerBtn,children:showForm?'등록취소':'물품등록'}),showForm&&/*#__PURE__*/_jsx(PostRegister,{onPostCreated:handlePostCreated,onCancel:()=>setShowForm(false)}),posts.length>0&&/*#__PURE__*/_jsx(PostList,{posts:posts,currentUserId:user._id,userRole:user.role,onRefresh:handleRefresh,onUpdate:handleUpdate}),/*#__PURE__*/_jsxs(\"div\",{className:styles.matchBox,children:[/*#__PURE__*/_jsxs(\"h3\",{children:[/*#__PURE__*/_jsx(\"i\",{className:styles.matchButton,style:{color:'#000',marginTop:'12px'}}),\"\\uB9E4\\uCE6D\\uCF54\\uB4DC\\uB85C \\uC5F0\\uACB0\\uD558\\uAE30\"]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:matchCodeInput,onChange:e=>setMatchCodeInput(e.target.value.toUpperCase()),placeholder:\"\\uB9E4\\uCE6D\\uCF54\\uB4DC\\uB97C \\uC785\\uB825\\uD558\\uC138\\uC694\",className:styles.input}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleMatchCode(matchCodeInput),children:[/*#__PURE__*/_jsx(\"i\",{className:styles.matchButton}),\"\\uB9E4\\uCE6D\\uD558\\uAE30\"]})]}),user.role==='admin'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83E\\uDDEA \\uB9E4\\uCE6D \\uAC00\\uB2A5\\uD55C \\uAE00 (\\uD14C\\uC2A4\\uD2B8\\uC6A9)\"}),availablePosts.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"\\uD604\\uC7AC \\uB9E4\\uCE6D \\uAC00\\uB2A5\\uD55C \\uAE00\\uC774 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\"}):/*#__PURE__*/_jsx(\"div\",{className:styles.matchList,children:availablePosts.map(post=>/*#__PURE__*/_jsxs(\"div\",{className:styles.card,children:[/*#__PURE__*/_jsx(\"h4\",{children:post.title}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uAE08\\uC561: \",post.price.toLocaleString(),\"\\uC6D0\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uB9E4\\uCE6D\\uCF54\\uB4DC: \",/*#__PURE__*/_jsx(\"strong\",{children:post.matchCode})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleMatchCode(post.matchCode),children:\"\\uD83E\\uDD1D \\uB9E4\\uCE6D\\uD558\\uAE30\"})]},post._id))})]})]})});}","map":{"version":3,"names":["useState","useEffect","useCallback","useNavigate","PostRegister","PostList","axios","styles","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","MyPosts","_ref","user","posts","setPosts","showForm","setShowForm","matchCodeInput","setMatchCodeInput","availablePosts","setAvailablePosts","token","localStorage","getItem","navigate","fetchPosts","_res$data$posts","res","get","headers","Authorization","concat","allPosts","Array","isArray","data","myPosts","filter","post","author","_id","matcher","role","matchablePosts","err","console","error","message","handlePostCreated","newPost","prev","handleUpdate","updatedPost","map","handleRefresh","handleMatchCode","code","length","alert","matchCode","_err$response","_err$response$data","msg","response","children","className","container","tit","onClick","registerBtn","onPostCreated","onCancel","currentUserId","userRole","onRefresh","onUpdate","matchBox","matchButton","style","color","marginTop","type","value","onChange","e","target","toUpperCase","placeholder","input","matchList","card","title","price","toLocaleString"],"sources":["D:/creative/react/hwaksee/client/src/pages/MyPosts.jsx"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport PostRegister from '../components/PostRegister';\r\nimport PostList from '../components/PostList';\r\nimport axios from '../api/axios';\r\nimport styles from '../css/Posts.module.css';\r\n\r\nexport default function MyPosts({ user }) {\r\n  const [posts, setPosts] = useState([]);\r\n  const [showForm, setShowForm] = useState(false);\r\n  const [matchCodeInput, setMatchCodeInput] = useState('');\r\n  const [availablePosts, setAvailablePosts] = useState([]);\r\n  const token = localStorage.getItem('token');\r\n  const navigate = useNavigate();\r\n\r\n  // ✅ 글 조회\r\n  const fetchPosts = useCallback(async () => {\r\n    try {\r\n      const res = await axios.get('/posts', {\r\n        headers: { Authorization: `Bearer ${token}` }\r\n      });\r\n\r\n      const allPosts = Array.isArray(res.data) ? res.data : res.data.posts ?? [];\r\n\r\n      const myPosts = allPosts.filter(post =>\r\n        post.author === user._id ||\r\n        post.matcher === user._id ||\r\n        user.role === 'admin'\r\n      );\r\n\r\n      const matchablePosts = allPosts.filter(post =>\r\n        post.author !== user._id && !post.matcher\r\n      );\r\n\r\n      setPosts(myPosts);\r\n      setAvailablePosts(matchablePosts);\r\n    } catch (err) {\r\n      console.error('글 불러오기 실패:', err.message);\r\n    }\r\n  }, [user._id, user.role, token]);\r\n\r\n  useEffect(() => {\r\n    fetchPosts();\r\n  }, [fetchPosts]);\r\n\r\n  // ✅ 글 등록\r\n  const handlePostCreated = newPost => {\r\n    setPosts(prev => [newPost, ...prev]);\r\n    setShowForm(false);\r\n  };\r\n\r\n  // ✅ 글 수정\r\n  const handleUpdate = updatedPost => {\r\n    setPosts(prev =>\r\n      prev.map(post => post._id === updatedPost._id ? updatedPost : post)\r\n    );\r\n  };\r\n\r\n  const handleRefresh = () => {\r\n    fetchPosts();\r\n  };\r\n\r\n  // ✅ 매칭코드 입력\r\n  const handleMatchCode = async (code) => {\r\n    if (!code || code.length < 4) {\r\n      alert('매칭코드를 정확히 입력해주세요.');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const res = await axios.post('/posts/match', { matchCode: code }, {\r\n        headers: { Authorization: `Bearer ${token}` }\r\n      });\r\n      alert('매칭 성공!');\r\n      navigate(`/posts/${res.data.post._id}`);\r\n    } catch (err) {\r\n      const msg = err.response?.data?.message || '서버 오류';\r\n      alert(`매칭 실패: ${msg}`);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <section>\r\n      <div className={styles.container}>\r\n        <h2 className={styles.tit}>My Posts</h2>\r\n\r\n        {/* 등록 버튼 */}\r\n        <button\r\n          onClick={() => setShowForm(prev => !prev)}\r\n          className={styles.registerBtn}\r\n        >\r\n          {showForm ? '등록취소' : '물품등록'}\r\n        </button>\r\n\r\n        {/* 글 등록 폼 */}\r\n        {showForm && (\r\n          <PostRegister\r\n            onPostCreated={handlePostCreated}\r\n            onCancel={() => setShowForm(false)}\r\n          />\r\n        )}\r\n\r\n        {/* 내 글 목록 */}\r\n        {posts.length > 0 && (\r\n          <PostList\r\n            posts={posts}\r\n            currentUserId={user._id}\r\n            userRole={user.role}\r\n            onRefresh={handleRefresh}\r\n            onUpdate={handleUpdate}\r\n          />\r\n        )}\r\n\r\n        {/* 매칭코드 입력 */}\r\n        <div className={styles.matchBox}>\r\n          <h3><i className={styles.matchButton} style={{ color: '#000', marginTop: '12px' }}></i>매칭코드로 연결하기</h3>\r\n          <input\r\n            type=\"text\"\r\n            value={matchCodeInput}\r\n            onChange={e => setMatchCodeInput(e.target.value.toUpperCase())}\r\n            placeholder=\"매칭코드를 입력하세요\"\r\n            className={styles.input}\r\n          />\r\n          <button onClick={() => handleMatchCode(matchCodeInput)}>\r\n            <i className={styles.matchButton}></i>매칭하기\r\n          </button>\r\n        </div>\r\n\r\n        {/* 관리자 테스트용 매칭글 */}\r\n        {user.role === 'admin' && (\r\n          <>\r\n            <h3>🧪 매칭 가능한 글 (테스트용)</h3>\r\n            {availablePosts.length === 0 ? (\r\n              <p>현재 매칭 가능한 글이 없습니다.</p>\r\n            ) : (\r\n              <div className={styles.matchList}>\r\n                {availablePosts.map(post => (\r\n                  <div key={post._id} className={styles.card}>\r\n                    <h4>{post.title}</h4>\r\n                    <p>금액: {post.price.toLocaleString()}원</p>\r\n                    <p>매칭코드: <strong>{post.matchCode}</strong></p>\r\n                    <button onClick={() => handleMatchCode(post.matchCode)}>\r\n                      🤝 매칭하기\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </>\r\n        )}\r\n      </div>\r\n    </section>\r\n  );\r\n}"],"mappings":"AAAA,OAASA,QAAQ,CAAEC,SAAS,CAAEC,WAAW,KAAQ,OAAO,CACxD,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,MAAO,CAAAC,YAAY,KAAM,4BAA4B,CACrD,MAAO,CAAAC,QAAQ,KAAM,wBAAwB,CAC7C,MAAO,CAAAC,KAAK,KAAM,cAAc,CAChC,MAAO,CAAAC,MAAM,KAAM,yBAAyB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAE7C,cAAe,SAAS,CAAAC,OAAOA,CAAAC,IAAA,CAAW,IAAV,CAAEC,IAAK,CAAC,CAAAD,IAAA,CACtC,KAAM,CAACE,KAAK,CAAEC,QAAQ,CAAC,CAAGlB,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAACmB,QAAQ,CAAEC,WAAW,CAAC,CAAGpB,QAAQ,CAAC,KAAK,CAAC,CAC/C,KAAM,CAACqB,cAAc,CAAEC,iBAAiB,CAAC,CAAGtB,QAAQ,CAAC,EAAE,CAAC,CACxD,KAAM,CAACuB,cAAc,CAAEC,iBAAiB,CAAC,CAAGxB,QAAQ,CAAC,EAAE,CAAC,CACxD,KAAM,CAAAyB,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,KAAM,CAAAC,QAAQ,CAAGzB,WAAW,CAAC,CAAC,CAE9B;AACA,KAAM,CAAA0B,UAAU,CAAG3B,WAAW,CAAC,SAAY,CACzC,GAAI,KAAA4B,eAAA,CACF,KAAM,CAAAC,GAAG,CAAG,KAAM,CAAAzB,KAAK,CAAC0B,GAAG,CAAC,QAAQ,CAAE,CACpCC,OAAO,CAAE,CAAEC,aAAa,WAAAC,MAAA,CAAYV,KAAK,CAAG,CAC9C,CAAC,CAAC,CAEF,KAAM,CAAAW,QAAQ,CAAGC,KAAK,CAACC,OAAO,CAACP,GAAG,CAACQ,IAAI,CAAC,CAAGR,GAAG,CAACQ,IAAI,EAAAT,eAAA,CAAGC,GAAG,CAACQ,IAAI,CAACtB,KAAK,UAAAa,eAAA,UAAAA,eAAA,CAAI,EAAE,CAE1E,KAAM,CAAAU,OAAO,CAAGJ,QAAQ,CAACK,MAAM,CAACC,IAAI,EAClCA,IAAI,CAACC,MAAM,GAAK3B,IAAI,CAAC4B,GAAG,EACxBF,IAAI,CAACG,OAAO,GAAK7B,IAAI,CAAC4B,GAAG,EACzB5B,IAAI,CAAC8B,IAAI,GAAK,OAChB,CAAC,CAED,KAAM,CAAAC,cAAc,CAAGX,QAAQ,CAACK,MAAM,CAACC,IAAI,EACzCA,IAAI,CAACC,MAAM,GAAK3B,IAAI,CAAC4B,GAAG,EAAI,CAACF,IAAI,CAACG,OACpC,CAAC,CAED3B,QAAQ,CAACsB,OAAO,CAAC,CACjBhB,iBAAiB,CAACuB,cAAc,CAAC,CACnC,CAAE,MAAOC,GAAG,CAAE,CACZC,OAAO,CAACC,KAAK,CAAC,YAAY,CAAEF,GAAG,CAACG,OAAO,CAAC,CAC1C,CACF,CAAC,CAAE,CAACnC,IAAI,CAAC4B,GAAG,CAAE5B,IAAI,CAAC8B,IAAI,CAAErB,KAAK,CAAC,CAAC,CAEhCxB,SAAS,CAAC,IAAM,CACd4B,UAAU,CAAC,CAAC,CACd,CAAC,CAAE,CAACA,UAAU,CAAC,CAAC,CAEhB;AACA,KAAM,CAAAuB,iBAAiB,CAAGC,OAAO,EAAI,CACnCnC,QAAQ,CAACoC,IAAI,EAAI,CAACD,OAAO,CAAE,GAAGC,IAAI,CAAC,CAAC,CACpClC,WAAW,CAAC,KAAK,CAAC,CACpB,CAAC,CAED;AACA,KAAM,CAAAmC,YAAY,CAAGC,WAAW,EAAI,CAClCtC,QAAQ,CAACoC,IAAI,EACXA,IAAI,CAACG,GAAG,CAACf,IAAI,EAAIA,IAAI,CAACE,GAAG,GAAKY,WAAW,CAACZ,GAAG,CAAGY,WAAW,CAAGd,IAAI,CACpE,CAAC,CACH,CAAC,CAED,KAAM,CAAAgB,aAAa,CAAGA,CAAA,GAAM,CAC1B7B,UAAU,CAAC,CAAC,CACd,CAAC,CAED;AACA,KAAM,CAAA8B,eAAe,CAAG,KAAO,CAAAC,IAAI,EAAK,CACtC,GAAI,CAACA,IAAI,EAAIA,IAAI,CAACC,MAAM,CAAG,CAAC,CAAE,CAC5BC,KAAK,CAAC,mBAAmB,CAAC,CAC1B,OACF,CAEA,GAAI,CACF,KAAM,CAAA/B,GAAG,CAAG,KAAM,CAAAzB,KAAK,CAACoC,IAAI,CAAC,cAAc,CAAE,CAAEqB,SAAS,CAAEH,IAAK,CAAC,CAAE,CAChE3B,OAAO,CAAE,CAAEC,aAAa,WAAAC,MAAA,CAAYV,KAAK,CAAG,CAC9C,CAAC,CAAC,CACFqC,KAAK,CAAC,QAAQ,CAAC,CACflC,QAAQ,WAAAO,MAAA,CAAWJ,GAAG,CAACQ,IAAI,CAACG,IAAI,CAACE,GAAG,CAAE,CAAC,CACzC,CAAE,MAAOI,GAAG,CAAE,KAAAgB,aAAA,CAAAC,kBAAA,CACZ,KAAM,CAAAC,GAAG,CAAG,EAAAF,aAAA,CAAAhB,GAAG,CAACmB,QAAQ,UAAAH,aAAA,kBAAAC,kBAAA,CAAZD,aAAA,CAAczB,IAAI,UAAA0B,kBAAA,iBAAlBA,kBAAA,CAAoBd,OAAO,GAAI,OAAO,CAClDW,KAAK,+BAAA3B,MAAA,CAAW+B,GAAG,CAAE,CAAC,CACxB,CACF,CAAC,CAED,mBACEzD,IAAA,YAAA2D,QAAA,cACEzD,KAAA,QAAK0D,SAAS,CAAE9D,MAAM,CAAC+D,SAAU,CAAAF,QAAA,eAC/B3D,IAAA,OAAI4D,SAAS,CAAE9D,MAAM,CAACgE,GAAI,CAAAH,QAAA,CAAC,UAAQ,CAAI,CAAC,cAGxC3D,IAAA,WACE+D,OAAO,CAAEA,CAAA,GAAMpD,WAAW,CAACkC,IAAI,EAAI,CAACA,IAAI,CAAE,CAC1Ce,SAAS,CAAE9D,MAAM,CAACkE,WAAY,CAAAL,QAAA,CAE7BjD,QAAQ,CAAG,MAAM,CAAG,MAAM,CACrB,CAAC,CAGRA,QAAQ,eACPV,IAAA,CAACL,YAAY,EACXsE,aAAa,CAAEtB,iBAAkB,CACjCuB,QAAQ,CAAEA,CAAA,GAAMvD,WAAW,CAAC,KAAK,CAAE,CACpC,CACF,CAGAH,KAAK,CAAC4C,MAAM,CAAG,CAAC,eACfpD,IAAA,CAACJ,QAAQ,EACPY,KAAK,CAAEA,KAAM,CACb2D,aAAa,CAAE5D,IAAI,CAAC4B,GAAI,CACxBiC,QAAQ,CAAE7D,IAAI,CAAC8B,IAAK,CACpBgC,SAAS,CAAEpB,aAAc,CACzBqB,QAAQ,CAAExB,YAAa,CACxB,CACF,cAGD5C,KAAA,QAAK0D,SAAS,CAAE9D,MAAM,CAACyE,QAAS,CAAAZ,QAAA,eAC9BzD,KAAA,OAAAyD,QAAA,eAAI3D,IAAA,MAAG4D,SAAS,CAAE9D,MAAM,CAAC0E,WAAY,CAACC,KAAK,CAAE,CAAEC,KAAK,CAAE,MAAM,CAAEC,SAAS,CAAE,MAAO,CAAE,CAAI,CAAC,0DAAU,EAAI,CAAC,cACtG3E,IAAA,UACE4E,IAAI,CAAC,MAAM,CACXC,KAAK,CAAEjE,cAAe,CACtBkE,QAAQ,CAAEC,CAAC,EAAIlE,iBAAiB,CAACkE,CAAC,CAACC,MAAM,CAACH,KAAK,CAACI,WAAW,CAAC,CAAC,CAAE,CAC/DC,WAAW,CAAC,+DAAa,CACzBtB,SAAS,CAAE9D,MAAM,CAACqF,KAAM,CACzB,CAAC,cACFjF,KAAA,WAAQ6D,OAAO,CAAEA,CAAA,GAAMb,eAAe,CAACtC,cAAc,CAAE,CAAA+C,QAAA,eACrD3D,IAAA,MAAG4D,SAAS,CAAE9D,MAAM,CAAC0E,WAAY,CAAI,CAAC,2BACxC,EAAQ,CAAC,EACN,CAAC,CAGLjE,IAAI,CAAC8B,IAAI,GAAK,OAAO,eACpBnC,KAAA,CAAAE,SAAA,EAAAuD,QAAA,eACE3D,IAAA,OAAA2D,QAAA,CAAI,gFAAkB,CAAI,CAAC,CAC1B7C,cAAc,CAACsC,MAAM,GAAK,CAAC,cAC1BpD,IAAA,MAAA2D,QAAA,CAAG,qFAAkB,CAAG,CAAC,cAEzB3D,IAAA,QAAK4D,SAAS,CAAE9D,MAAM,CAACsF,SAAU,CAAAzB,QAAA,CAC9B7C,cAAc,CAACkC,GAAG,CAACf,IAAI,eACtB/B,KAAA,QAAoB0D,SAAS,CAAE9D,MAAM,CAACuF,IAAK,CAAA1B,QAAA,eACzC3D,IAAA,OAAA2D,QAAA,CAAK1B,IAAI,CAACqD,KAAK,CAAK,CAAC,cACrBpF,KAAA,MAAAyD,QAAA,EAAG,gBAAI,CAAC1B,IAAI,CAACsD,KAAK,CAACC,cAAc,CAAC,CAAC,CAAC,QAAC,EAAG,CAAC,cACzCtF,KAAA,MAAAyD,QAAA,EAAG,4BAAM,cAAA3D,IAAA,WAAA2D,QAAA,CAAS1B,IAAI,CAACqB,SAAS,CAAS,CAAC,EAAG,CAAC,cAC9CtD,IAAA,WAAQ+D,OAAO,CAAEA,CAAA,GAAMb,eAAe,CAACjB,IAAI,CAACqB,SAAS,CAAE,CAAAK,QAAA,CAAC,uCAExD,CAAQ,CAAC,GAND1B,IAAI,CAACE,GAOV,CACN,CAAC,CACC,CACN,EACD,CACH,EACE,CAAC,CACC,CAAC,CAEd","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}