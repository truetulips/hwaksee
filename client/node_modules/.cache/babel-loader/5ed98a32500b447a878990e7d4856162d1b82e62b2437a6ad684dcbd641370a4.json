{"ast":null,"code":"import _objectSpread from\"D:/creative/react/hwaksee/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useState}from'react';import{useNavigate}from'react-router-dom';import axios from'../api/axios';import styles from'../css/Form.module.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function LoginForm(_ref){let{onLogin}=_ref;const[form,setForm]=useState({phone:'',password:''});const[error,setError]=useState('');const[showPassword,setShowPassword]=useState(false);const navigate=useNavigate();// ‚úÖ Í≥ÑÏ†ï Ï†ïÎ¶¨ Ï°∞Í±¥: Í±∞Îûò ÏôÑÎ£åÎêú Í∏ÄÎßå ÎÇ®ÏïÑÏûàÏùÑ Îïå\nconst checkUserPosts=async token=>{try{const res=await axios.get('/posts/my',{headers:{Authorization:\"Bearer \".concat(token)}});const posts=res.data;const hasActivePost=posts.some(post=>{const matched=post.matcher!==null;const buyerDone=post.buyerStatus==='ÏôÑÎ£å';const sellerDone=post.sellerStatus==='ÏôÑÎ£å';return matched&&(!buyerDone||!sellerDone);});if(!hasActivePost){await axios.patch('/users/mark-inactive',{},{headers:{Authorization:\"Bearer \".concat(token)}});console.log('üïí Í≥ÑÏ†ï Ï†ïÎ¶¨ ÏòàÏïΩÎê® (Í±∞Îûò ÏôÑÎ£åÎêú Í∏ÄÎßå Ï°¥Ïû¨)');}}catch(err){console.warn('‚ö†Ô∏è Í≥ÑÏ†ï Ï†ïÎ¶¨ ÌôïÏù∏ Ïã§Ìå®:',err.message);}};const handleChange=e=>{const{name,value}=e.target;setForm(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));setError('');};const handleSubmit=async e=>{e.preventDefault();try{const res=await axios.post('/auth/login',form);const{token,user}=res.data;localStorage.setItem('token',token);onLogin(user);navigate('/');await checkUserPosts(token);}catch(err){var _err$response,_err$response$data;const msg=(_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message;if(msg==='Ï°¥Ïû¨ÌïòÏßÄ ÏïäÎäî ÏÇ¨Ïö©ÏûêÏûÖÎãàÎã§.'){setError(msg);// Í∑∏ÎåÄÎ°ú Ï∂úÎ†•\n}else if(msg==='ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§.'){setError(msg);}else{setError(msg||'Î°úÍ∑∏Ïù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');}}};return/*#__PURE__*/_jsx(\"form\",{onSubmit:handleSubmit,className:styles.form,children:/*#__PURE__*/_jsxs(\"section\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uB85C\\uADF8\\uC778\"}),/*#__PURE__*/_jsxs(\"div\",{className:styles.regFormbox,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"phone\",placeholder:\"\\uC804\\uD654\\uBC88\\uD638\",value:form.phone,onChange:handleChange,required:true,className:styles.input}),/*#__PURE__*/_jsxs(\"div\",{className:styles.passwordWrapper,children:[/*#__PURE__*/_jsx(\"input\",{type:showPassword?'text':'password',name:\"password\",placeholder:\"\\uBE44\\uBC00\\uBC88\\uD638\",value:form.password,onChange:handleChange,required:true,className:styles.input}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setShowPassword(prev=>!prev),className:styles.toggle,children:showPassword?'üôà Ïà®Í∏∞Í∏∞':'üëÅÔ∏è ÏïîÌò∏Î≥¥Í∏∞'})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:styles.error,children:error}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"\\uB85C\\uADF8\\uC778\"})]})]})});}","map":{"version":3,"names":["useState","useNavigate","axios","styles","jsx","_jsx","jsxs","_jsxs","LoginForm","_ref","onLogin","form","setForm","phone","password","error","setError","showPassword","setShowPassword","navigate","checkUserPosts","token","res","get","headers","Authorization","concat","posts","data","hasActivePost","some","post","matched","matcher","buyerDone","buyerStatus","sellerDone","sellerStatus","patch","console","log","err","warn","message","handleChange","e","name","value","target","prev","_objectSpread","handleSubmit","preventDefault","user","localStorage","setItem","_err$response","_err$response$data","msg","response","onSubmit","className","children","regFormbox","type","placeholder","onChange","required","input","passwordWrapper","onClick","toggle"],"sources":["D:/creative/react/hwaksee/client/src/components/LoginForm.jsx"],"sourcesContent":["import { useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport axios from '../api/axios';\r\nimport styles from '../css/Form.module.css';\r\n\r\nexport default function LoginForm({ onLogin }) {\r\n  const [form, setForm] = useState({ phone: '', password: '' });\r\n  const [error, setError] = useState('');\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const navigate = useNavigate();\r\n\r\n  // ‚úÖ Í≥ÑÏ†ï Ï†ïÎ¶¨ Ï°∞Í±¥: Í±∞Îûò ÏôÑÎ£åÎêú Í∏ÄÎßå ÎÇ®ÏïÑÏûàÏùÑ Îïå\r\n  const checkUserPosts = async (token) => {\r\n    try {\r\n      const res = await axios.get('/posts/my', {\r\n        headers: { Authorization: `Bearer ${token}` }\r\n      });\r\n\r\n      const posts = res.data;\r\n\r\n      const hasActivePost = posts.some(post => {\r\n        const matched = post.matcher !== null;\r\n        const buyerDone = post.buyerStatus === 'ÏôÑÎ£å';\r\n        const sellerDone = post.sellerStatus === 'ÏôÑÎ£å';\r\n        return matched && (!buyerDone || !sellerDone);\r\n      });\r\n\r\n      if (!hasActivePost) {\r\n        await axios.patch('/users/mark-inactive', {}, {\r\n          headers: { Authorization: `Bearer ${token}` }\r\n        });\r\n        console.log('üïí Í≥ÑÏ†ï Ï†ïÎ¶¨ ÏòàÏïΩÎê® (Í±∞Îûò ÏôÑÎ£åÎêú Í∏ÄÎßå Ï°¥Ïû¨)');\r\n      }\r\n    } catch (err) {\r\n      console.warn('‚ö†Ô∏è Í≥ÑÏ†ï Ï†ïÎ¶¨ ÌôïÏù∏ Ïã§Ìå®:', err.message);\r\n    }\r\n  };\r\n\r\n  const handleChange = e => {\r\n    const { name, value } = e.target;\r\n    setForm(prev => ({ ...prev, [name]: value }));\r\n    setError('');\r\n  };\r\n\r\n  const handleSubmit = async e => {\r\n    e.preventDefault();\r\n    try {\r\n      const res = await axios.post('/auth/login', form);\r\n      const { token, user } = res.data;\r\n\r\n      localStorage.setItem('token', token);\r\n      onLogin(user);\r\n      navigate('/');\r\n\r\n      await checkUserPosts(token);\r\n    } catch (err) {\r\n      const msg = err.response?.data?.message;\r\n      if (msg === 'Ï°¥Ïû¨ÌïòÏßÄ ÏïäÎäî ÏÇ¨Ïö©ÏûêÏûÖÎãàÎã§.') {\r\n        setError(msg); // Í∑∏ÎåÄÎ°ú Ï∂úÎ†•\r\n      } else if (msg === 'ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§.') {\r\n        setError(msg);\r\n      } else {\r\n        setError(msg || 'Î°úÍ∑∏Ïù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className={styles.form}>\r\n      <section>\r\n        <h2>Î°úÍ∑∏Ïù∏</h2>\r\n\r\n        <div className={styles.regFormbox}>\r\n          <input\r\n            type=\"text\"\r\n            name=\"phone\"\r\n            placeholder=\"Ï†ÑÌôîÎ≤àÌò∏\"\r\n            value={form.phone}\r\n            onChange={handleChange}\r\n            required\r\n            className={styles.input}\r\n          />\r\n\r\n          <div className={styles.passwordWrapper}>\r\n            <input\r\n              type={showPassword ? 'text' : 'password'}\r\n              name=\"password\"\r\n              placeholder=\"ÎπÑÎ∞ÄÎ≤àÌò∏\"\r\n              value={form.password}\r\n              onChange={handleChange}\r\n              required\r\n              className={styles.input}\r\n            />\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => setShowPassword(prev => !prev)}\r\n              className={styles.toggle}\r\n            >\r\n              {showPassword ? 'üôà Ïà®Í∏∞Í∏∞' : 'üëÅÔ∏è ÏïîÌò∏Î≥¥Í∏∞'}\r\n            </button>\r\n          </div>\r\n\r\n          {error && <div className={styles.error}>{error}</div>}\r\n\r\n          <button type=\"submit\">Î°úÍ∑∏Ïù∏</button>\r\n        </div>\r\n      </section>\r\n    </form>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}